version: '3.8'

services:
  victoriametrics:
    image: victoriametrics/victoria-metrics:latest
    container_name: victoriametrics-prefect
    ports:
      - "8429:8428"
    volumes:
      - victoriametrics-data-prefect:/victoria-metrics-data
    command:
      - "--storageDataPath=/victoria-metrics-data"
      - "--httpListenAddr=:8428"
    restart: unless-stopped
    networks:
      - prefect-network

  prefect:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: prefect-vic
    ports:
      - "4200:4200"
    volumes:
      - .:/app:Z
      - ../data:/app/data:Z
      - prefect-data:/app/.prefect:Z
    environment:
      - VICTORIAMETRICS_URL=http://victoriametrics-prefect:8428
    depends_on:
      - victoriametrics
    restart: unless-stopped
    networks:
      - prefect-network

volumes:
  victoriametrics-data-prefect:
  prefect-data:

networks:
  prefect-network:
    driver: bridge

